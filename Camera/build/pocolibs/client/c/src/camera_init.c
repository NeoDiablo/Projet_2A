/* --- Generated by genom 2.99.29. Do not edit -------------------------- */

#include "autoconf/acheader.h"

#include <errno.h>
#include <stdlib.h>
#include <stdio.h>
#include <string.h>

#include "genom3/c/client.h"
#include "private.h"
#include "camera/c/client.h"
#include "camera_msglib.h"


/* --- local data ---------------------------------------------------------- */

size_t camera_varmsg_maxsize = 32768;


/* --- camera_init ------------------------------------------------------ */

genom_client
genom_camera_client_init(int argc, char *argv[],
                            genom_event *ex, const void **exdetail)
{
  struct pocolibs_options opts;
  char *largv[argc+1];
  genom_state_component state;
  genom_client h;
  int i, e;

  h = malloc(sizeof(*h));
  if (!h) {
    if (ex) *ex = genom_fatal;
    if (exdetail) *exdetail = NULL;
    return NULL;
  }
  h->context.raise = genom_pocolibs_client_raise;
  h->context.raised = genom_pocolibs_client_raised;
  h->context.data = &h->context_data;

  h->context_data.h = h;
  h->context_data.ex = genom_ok;
  h->context_data.exdetail = NULL;
  h->context_data.exsize = 0;

  h->instance = NULL;
  h->csid = NULL;
  h->active_rqst = NULL;
  h->nactive = h->next = 0;

  /* must shift args so that getopt() works (argv[0] must be progname) */
  largv[0] = "camera";
  for(i=0; i<argc; i++) {
    largv[i+1] = argv[i];
  }

  if (pocolibs_getopt(h, argc+1, largv, &opts)) {
    if (ex) *ex = h->context_data.ex;
    if (exdetail) *exdetail = h->context_data.exdetail;
    free(h);
    return NULL;
  }
  camera_varmsg_maxsize = opts.varmsg_maxsize;

  if (pocolibs_init(h, CAMERA_CLIENT_MBOX_REPLY_SIZE)) goto error;

  /* connect to server mbox */
  h->instance = strdup(opts.instance?opts.instance:"camera");
  e = csClientInit(h->instance,
                   CAMERA_MAX_RQST_SIZE,
                   CAMERA_MAX_INTERMED_REPLY_SIZE,
                   CAMERA_MAX_REPLY_SIZE,
                   &h->csid);
  if (e != OK) {
    e = errnoGet();
    if (H2_SYS_ERR_FLAG(e))
      genom_syserr(&(genom_syserr_detail){ .code = e }, &h->context);
    else {
      genom_mwerr_detail d;
      h2getErrMsg(e, d.what, sizeof(d.what));
      genom_mwerr(&d, &h->context);
    }
    goto error;
  }

  /* check digest */
  genom_camera_client_genom_state_init_data(&state);
  if (genom_camera_client_genom_state_port(h, &state)) goto error;

  if (strcmp(state.digest, "3a577514ec4ec06f63ebfc5e2a1afab4")) {
    genom_incompatible_digest_detail d;
    strcpy(d.server.version, state.version);
    strcpy(d.server.date, state.date);
    strcpy(d.client.version, "1.0");
    strcpy(d.client.date, "Wed Jul 19 16:32:34 CEST 2017");
    genom_incompatible_digest(&d, &h->context);
    genom_camera_client_genom_state_fini_data(&state);
    goto error;
  }
  genom_camera_client_genom_state_fini_data(&state);

  return h;

error:
  if (ex) *ex = h->context_data.ex;
  if (exdetail) *exdetail = h->context_data.exdetail;
  pocolibs_fini();
  if (h->instance) free(h->instance);
  free(h);
  return NULL;
}


/* --- camera_fini ------------------------------------------------------ */

void
genom_camera_client_fini(genom_client h)
{
  if (h) {
    if (h->csid) csClientEnd(h->csid);
    pocolibs_fini();
    if (h->instance) free(h->instance);
    if (h->active_rqst) free(h->active_rqst);
    free(h);
  }
}


/* --- camera_context --------------------------------------------------- */

genom_context
genom_camera_client_context(genom_client h)
{
  return &h->context;
}


/* --- camera_name ------------------------------------------------------ */

const char *
genom_camera_client_instance(genom_client h)
{
  return h->instance;
}


/* --- camera_eventfd --------------------------------------------------- */

int
genom_camera_client_eventfd(genom_client h)
{
  (void)h; /* fix -Wunused-parameter */
  return pocolibs_eventfd();
}


/* --- camera_service_info ---------------------------------------------- */

const struct genom_service_info *
genom_camera_client_service_info(genom_client h, int rqstid)
{
  return pocolibs_service_info(h, rqstid);
}


/* --- camera_done ------------------------------------------------------ */

int
genom_camera_client_done(genom_client h, int rqstid)
{
  return pocolibs_done(h, rqstid);
}


/* --- camera_wait ------------------------------------------------------ */

genom_event
genom_camera_client_wait(genom_client h, int rqstid)
{
  return pocolibs_waitterm(h, rqstid);
}


/* --- camera_clean ----------------------------------------------------- */

genom_event
genom_camera_client_clean(genom_client h, int rqstid)
{
  return pocolibs_clean(h, rqstid);
}


/* --- camera_doevents -------------------------------------------------- */

genom_event
genom_camera_client_doevents(genom_client h)
{
  return pocolibs_doevents(h);
}


/* --- component info ------------------------------------------------------ */

static const struct genom_service_info genom_service_info[] = {
  {
    .name = "abort_activity",
    .input = "{ \"activity\":{ \"kind\":\"unsigned long\" } }",
    .output = "{ }",
    .meta = "{ \"activity\":{ \"doc\":\"Activity id\" } }",
    .init_input =
    (genom_initfn)genom_camera_client_abort_activity_init_input,
    .init_output =
    (genom_initfn)genom_camera_client_abort_activity_init_output,
    .fini_input =
    (genom_finifn)genom_camera_client_abort_activity_fini_input,
    .fini_output =
    (genom_finifn)genom_camera_client_abort_activity_fini_output,
    .json_scan =
    (genom_json_scanfn)genom_camera_client_abort_activity_json_scan,
    .json_print =
    (genom_json_printfn)genom_camera_client_abort_activity_json_print,
    .send =
    (genom_request_sendfn)genom_camera_client_abort_activity_rqst,
    .input_size = sizeof(struct genom_camera_abort_activity_input),
    .output_size = sizeof(struct genom_camera_abort_activity_output)
  },
  {
    .name = "connect_port",
    .input = "{ \"local\":{ \"kind\":\"string\",\"length\":128 },\"remote\":{ \"kind\":\"string\",\"length\":128 } }",
    .output = "{ }",
    .meta = "{ \"local\":{ \"doc\":\"Local input port\" },\"remote\":{ \"doc\":\"Output port to connect to\" } }",
    .init_input =
    (genom_initfn)genom_camera_client_connect_port_init_input,
    .init_output =
    (genom_initfn)genom_camera_client_connect_port_init_output,
    .fini_input =
    (genom_finifn)genom_camera_client_connect_port_fini_input,
    .fini_output =
    (genom_finifn)genom_camera_client_connect_port_fini_output,
    .json_scan =
    (genom_json_scanfn)genom_camera_client_connect_port_json_scan,
    .json_print =
    (genom_json_printfn)genom_camera_client_connect_port_json_print,
    .send =
    (genom_request_sendfn)genom_camera_client_connect_port_rqst,
    .input_size = sizeof(struct genom_camera_connect_port_input),
    .output_size = sizeof(struct genom_camera_connect_port_output)
  },
  {
    .name = "connect_service",
    .input = "{ \"local\":{ \"kind\":\"string\",\"length\":128 },\"remote\":{ \"kind\":\"string\",\"length\":128 } }",
    .output = "{ }",
    .meta = "{ \"local\":{ \"doc\":\"Local service name\" },\"remote\":{ \"doc\":\"Remote service name\" } }",
    .init_input =
    (genom_initfn)genom_camera_client_connect_service_init_input,
    .init_output =
    (genom_initfn)genom_camera_client_connect_service_init_output,
    .fini_input =
    (genom_finifn)genom_camera_client_connect_service_fini_input,
    .fini_output =
    (genom_finifn)genom_camera_client_connect_service_fini_output,
    .json_scan =
    (genom_json_scanfn)genom_camera_client_connect_service_json_scan,
    .json_print =
    (genom_json_printfn)genom_camera_client_connect_service_json_print,
    .send =
    (genom_request_sendfn)genom_camera_client_connect_service_rqst,
    .input_size = sizeof(struct genom_camera_connect_service_input),
    .output_size = sizeof(struct genom_camera_connect_service_output)
  },
  {
    .name = "kill",
    .input = "{ }",
    .output = "{ }",
    .meta = "{ }",
    .init_input =
    (genom_initfn)genom_camera_client_kill_init_input,
    .init_output =
    (genom_initfn)genom_camera_client_kill_init_output,
    .fini_input =
    (genom_finifn)genom_camera_client_kill_fini_input,
    .fini_output =
    (genom_finifn)genom_camera_client_kill_fini_output,
    .json_scan =
    (genom_json_scanfn)genom_camera_client_kill_json_scan,
    .json_print =
    (genom_json_printfn)genom_camera_client_kill_json_print,
    .send =
    (genom_request_sendfn)genom_camera_client_kill_rqst,
    .input_size = sizeof(struct genom_camera_kill_input),
    .output_size = sizeof(struct genom_camera_kill_output)
  },
  {
    .name = "GetCurrentPosition",
    .input = "{ }",
    .output = "{ \"position\":{ \"kind\":\"struct\",\"type\":{ \"position_avant\":{ \"kind\":\"struct\",\"type\":{ \"x\":{ \"kind\":\"float\" },\"y\":{ \"kind\":\"float\" } } },\"position_arriere_gauche\":{ \"kind\":\"struct\",\"type\":{ \"x\":{ \"kind\":\"float\" },\"y\":{ \"kind\":\"float\" } } },\"position_arriere_droit\":{ \"kind\":\"struct\",\"type\":{ \"x\":{ \"kind\":\"float\" },\"y\":{ \"kind\":\"float\" } } } } } }",
    .meta = "{ }",
    .init_input =
    (genom_initfn)genom_camera_client_GetCurrentPosition_init_input,
    .init_output =
    (genom_initfn)genom_camera_client_GetCurrentPosition_init_output,
    .fini_input =
    (genom_finifn)genom_camera_client_GetCurrentPosition_fini_input,
    .fini_output =
    (genom_finifn)genom_camera_client_GetCurrentPosition_fini_output,
    .json_scan =
    (genom_json_scanfn)genom_camera_client_GetCurrentPosition_json_scan,
    .json_print =
    (genom_json_printfn)genom_camera_client_GetCurrentPosition_json_print,
    .send =
    (genom_request_sendfn)genom_camera_client_GetCurrentPosition_rqst,
    .input_size = sizeof(struct genom_camera_GetCurrentPosition_input),
    .output_size = sizeof(struct genom_camera_GetCurrentPosition_output)
  },
  {
    .name = "GetCurrentMap",
    .input = "{ }",
    .output = "{ \"image\":{ \"kind\":\"struct\",\"type\":{ \"R\":{ \"kind\":\"float\" },\"G\":{ \"kind\":\"float\" },\"B\":{ \"kind\":\"float\" } } } }",
    .meta = "{ }",
    .init_input =
    (genom_initfn)genom_camera_client_GetCurrentMap_init_input,
    .init_output =
    (genom_initfn)genom_camera_client_GetCurrentMap_init_output,
    .fini_input =
    (genom_finifn)genom_camera_client_GetCurrentMap_fini_input,
    .fini_output =
    (genom_finifn)genom_camera_client_GetCurrentMap_fini_output,
    .json_scan =
    (genom_json_scanfn)genom_camera_client_GetCurrentMap_json_scan,
    .json_print =
    (genom_json_printfn)genom_camera_client_GetCurrentMap_json_print,
    .send =
    (genom_request_sendfn)genom_camera_client_GetCurrentMap_rqst,
    .input_size = sizeof(struct genom_camera_GetCurrentMap_input),
    .output_size = sizeof(struct genom_camera_GetCurrentMap_output)
  },
  {
    .name = "GetCurrentArena",
    .input = "{ }",
    .output = "{ \"arene\":{ \"kind\":\"struct\",\"type\":{ \"haut_gauche\":{ \"kind\":\"struct\",\"type\":{ \"x\":{ \"kind\":\"float\" },\"y\":{ \"kind\":\"float\" } } },\"haut_droit\":{ \"kind\":\"struct\",\"type\":{ \"x\":{ \"kind\":\"float\" },\"y\":{ \"kind\":\"float\" } } },\"bas_gauche\":{ \"kind\":\"struct\",\"type\":{ \"x\":{ \"kind\":\"float\" },\"y\":{ \"kind\":\"float\" } } },\"bas_droit\":{ \"kind\":\"struct\",\"type\":{ \"x\":{ \"kind\":\"float\" },\"y\":{ \"kind\":\"float\" } } } } } }",
    .meta = "{ }",
    .init_input =
    (genom_initfn)genom_camera_client_GetCurrentArena_init_input,
    .init_output =
    (genom_initfn)genom_camera_client_GetCurrentArena_init_output,
    .fini_input =
    (genom_finifn)genom_camera_client_GetCurrentArena_fini_input,
    .fini_output =
    (genom_finifn)genom_camera_client_GetCurrentArena_fini_output,
    .json_scan =
    (genom_json_scanfn)genom_camera_client_GetCurrentArena_json_scan,
    .json_print =
    (genom_json_printfn)genom_camera_client_GetCurrentArena_json_print,
    .send =
    (genom_request_sendfn)genom_camera_client_GetCurrentArena_rqst,
    .input_size = sizeof(struct genom_camera_GetCurrentArena_input),
    .output_size = sizeof(struct genom_camera_GetCurrentArena_output)
  },
  {
    .name = "FilmStop",
    .input = "{ }",
    .output = "{ }",
    .meta = "{ }",
    .init_input =
    (genom_initfn)genom_camera_client_FilmStop_init_input,
    .init_output =
    (genom_initfn)genom_camera_client_FilmStop_init_output,
    .fini_input =
    (genom_finifn)genom_camera_client_FilmStop_fini_input,
    .fini_output =
    (genom_finifn)genom_camera_client_FilmStop_fini_output,
    .json_scan =
    (genom_json_scanfn)genom_camera_client_FilmStop_json_scan,
    .json_print =
    (genom_json_printfn)genom_camera_client_FilmStop_json_print,
    .send =
    (genom_request_sendfn)genom_camera_client_FilmStop_rqst,
    .input_size = sizeof(struct genom_camera_FilmStop_input),
    .output_size = sizeof(struct genom_camera_FilmStop_output)
  },
  {
    .name = "StartFilm",
    .input = "{ }",
    .output = "{ }",
    .meta = "{ }",
    .init_input =
    (genom_initfn)genom_camera_client_StartFilm_init_input,
    .init_output =
    (genom_initfn)genom_camera_client_StartFilm_init_output,
    .fini_input =
    (genom_finifn)genom_camera_client_StartFilm_fini_input,
    .fini_output =
    (genom_finifn)genom_camera_client_StartFilm_fini_output,
    .json_scan =
    (genom_json_scanfn)genom_camera_client_StartFilm_json_scan,
    .json_print =
    (genom_json_printfn)genom_camera_client_StartFilm_json_print,
    .send =
    (genom_request_sendfn)genom_camera_client_StartFilm_rqst,
    .input_size = sizeof(struct genom_camera_StartFilm_input),
    .output_size = sizeof(struct genom_camera_StartFilm_output)
  },
  { .name = NULL, .input = NULL, .output = NULL, .meta = NULL, .send = NULL }
};

static const struct genom_port_info genom_port_info[] = {
  {
    .name = "genom_state",
    .data = "{ \"genom_state\":{ \"kind\":\"struct\",\"type\":{ \"task\":{ \"kind\":\"sequence\",\"type\":{ \"kind\":\"struct\",\"type\":{ \"name\":{ \"kind\":\"string\",\"length\":64 },\"rusage\":{ \"kind\":\"struct\",\"type\":{ \"cycles\":{ \"kind\":\"unsigned long\" },\"timings\":{ \"kind\":\"struct\",\"type\":{ \"last\":{ \"kind\":\"float\" },\"max\":{ \"kind\":\"float\" },\"avg\":{ \"kind\":\"float\" } } },\"load\":{ \"kind\":\"struct\",\"type\":{ \"last\":{ \"kind\":\"float\" },\"max\":{ \"kind\":\"float\" },\"avg\":{ \"kind\":\"float\" } } } } },\"activity\":{ \"kind\":\"sequence\",\"type\":{ \"kind\":\"struct\",\"type\":{ \"id\":{ \"kind\":\"unsigned long\" },\"name\":{ \"kind\":\"string\",\"length\":64 } } } } } } },\"digest\":{ \"kind\":\"string\",\"length\":33 },\"date\":{ \"kind\":\"string\",\"length\":31 },\"version\":{ \"kind\":\"string\",\"length\":32 } } } }",
    .meta = "{}",
    .init_data =
    (genom_initfn)genom_camera_client_genom_state_init_data,
    .fini_data =
    (genom_finifn)genom_camera_client_genom_state_fini_data,
    .json_print =
    (genom_json_printfn)genom_camera_client_genom_state_json_print,
    .simple = 1,
    .read.simple =
    (genom_port_readfn)genom_camera_client_genom_state_port,
    .data_size = sizeof(genom_state_component)
  },
  {
    .name = "AR",
    .data = "{ \"AR\":{ \"kind\":\"struct\",\"type\":{ \"haut_gauche\":{ \"kind\":\"struct\",\"type\":{ \"x\":{ \"kind\":\"float\" },\"y\":{ \"kind\":\"float\" } } },\"haut_droit\":{ \"kind\":\"struct\",\"type\":{ \"x\":{ \"kind\":\"float\" },\"y\":{ \"kind\":\"float\" } } },\"bas_gauche\":{ \"kind\":\"struct\",\"type\":{ \"x\":{ \"kind\":\"float\" },\"y\":{ \"kind\":\"float\" } } },\"bas_droit\":{ \"kind\":\"struct\",\"type\":{ \"x\":{ \"kind\":\"float\" },\"y\":{ \"kind\":\"float\" } } } } } }",
    .meta = "{}",
    .init_data =
    (genom_initfn)genom_camera_client_AR_init_data,
    .fini_data =
    (genom_finifn)genom_camera_client_AR_fini_data,
    .json_print =
    (genom_json_printfn)genom_camera_client_AR_json_print,
    .simple = 1,
    .read.simple =
    (genom_port_readfn)genom_camera_client_AR_port,
    .data_size = sizeof(camera_arena)
  },
  {
    .name = "POS",
    .data = "{ \"POS\":{ \"kind\":\"struct\",\"type\":{ \"position_avant\":{ \"kind\":\"struct\",\"type\":{ \"x\":{ \"kind\":\"float\" },\"y\":{ \"kind\":\"float\" } } },\"position_arriere_gauche\":{ \"kind\":\"struct\",\"type\":{ \"x\":{ \"kind\":\"float\" },\"y\":{ \"kind\":\"float\" } } },\"position_arriere_droit\":{ \"kind\":\"struct\",\"type\":{ \"x\":{ \"kind\":\"float\" },\"y\":{ \"kind\":\"float\" } } } } } }",
    .meta = "{}",
    .init_data =
    (genom_initfn)genom_camera_client_POS_init_data,
    .fini_data =
    (genom_finifn)genom_camera_client_POS_fini_data,
    .json_print =
    (genom_json_printfn)genom_camera_client_POS_json_print,
    .simple = 1,
    .read.simple =
    (genom_port_readfn)genom_camera_client_POS_port,
    .data_size = sizeof(camera_robot)
  },
  {
    .name = "IM",
    .data = "{ \"IM\":{ \"kind\":\"struct\",\"type\":{ \"R\":{ \"kind\":\"float\" },\"G\":{ \"kind\":\"float\" },\"B\":{ \"kind\":\"float\" } } } }",
    .meta = "{}",
    .init_data =
    (genom_initfn)genom_camera_client_IM_init_data,
    .fini_data =
    (genom_finifn)genom_camera_client_IM_fini_data,
    .json_print =
    (genom_json_printfn)genom_camera_client_IM_json_print,
    .simple = 1,
    .read.simple =
    (genom_port_readfn)genom_camera_client_IM_port,
    .data_size = sizeof(camera_map)
  },
  { .name = NULL, .data = NULL, .meta = NULL,
    .init_data = NULL, .fini_data = NULL, .json_print = NULL,
    .simple = 1, .read.simple = NULL, .data_size = 0
  }
};

const struct genom_client_info genom_camera_client_info = {
  .protocol = genom_client_protocol,
  .name = "camera",
  .options = genom_pocolibs_options,

  .init = genom_camera_client_init,
  .fini = genom_camera_client_fini,
  .context = genom_camera_client_context,
  .instance = genom_camera_client_instance,
  .eventfd = genom_camera_client_eventfd,
  .service_info = genom_camera_client_service_info,
  .done = genom_camera_client_done,
  .wait = genom_camera_client_wait,
  .result = pocolibs_result,
  .clean = genom_camera_client_clean,
  .abort = genom_camera_client_abort,
  .doevents = genom_camera_client_doevents,
  .json_error = genom_camera_client_json_error,

  .nservices = 9,
  .services = genom_service_info,

  .nports = 4,
  .ports = genom_port_info
};

const struct genom_service_info *genom_camera_client_abort_activity_info =
  &genom_service_info[0];
const struct genom_service_info *genom_camera_client_connect_port_info =
  &genom_service_info[1];
const struct genom_service_info *genom_camera_client_connect_service_info =
  &genom_service_info[2];
const struct genom_service_info *genom_camera_client_kill_info =
  &genom_service_info[3];
const struct genom_service_info *genom_camera_client_GetCurrentPosition_info =
  &genom_service_info[4];
const struct genom_service_info *genom_camera_client_GetCurrentMap_info =
  &genom_service_info[5];
const struct genom_service_info *genom_camera_client_GetCurrentArena_info =
  &genom_service_info[6];
const struct genom_service_info *genom_camera_client_FilmStop_info =
  &genom_service_info[7];
const struct genom_service_info *genom_camera_client_StartFilm_info =
  &genom_service_info[8];

const struct genom_port_info *genom_camera_client_genom_state_info =
  &genom_port_info[0];
const struct genom_port_info *genom_camera_client_AR_info =
  &genom_port_info[1];
const struct genom_port_info *genom_camera_client_POS_info =
  &genom_port_info[2];
const struct genom_port_info *genom_camera_client_IM_info =
  &genom_port_info[3];
