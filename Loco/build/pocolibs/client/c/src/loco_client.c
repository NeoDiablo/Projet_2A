/* --- Generated by genom 2.99.29. Do not edit -------------------------- */

#include "autoconf/acheader.h"

#include <stdio.h>

#include "h2devLib.h"
#include "posterLib.h"

#include "loco/c/client.h"
#include "loco_msglib.h"
#include "private.h"
#include "serialize.h"


/* --- local data ---------------------------------------------------------- */

int	genom_loco_abort_activity_encode(char *buffer, int size,
		char *dst, int maxsize);
int	genom_loco_abort_activity_decode(char *buffer, int size,
		char *dst, int maxsize);
int	genom_loco_connect_port_encode(char *buffer, int size,
		char *dst, int maxsize);
int	genom_loco_connect_port_decode(char *buffer, int size,
		char *dst, int maxsize);
int	genom_loco_connect_service_encode(char *buffer, int size,
		char *dst, int maxsize);
int	genom_loco_connect_service_decode(char *buffer, int size,
		char *dst, int maxsize);
int	genom_loco_kill_encode(char *buffer, int size,
		char *dst, int maxsize);
int	genom_loco_kill_decode(char *buffer, int size,
		char *dst, int maxsize);
int	genom_loco_GetCurrentPosition_encode(char *buffer, int size,
		char *dst, int maxsize);
int	genom_loco_GetCurrentPosition_decode(char *buffer, int size,
		char *dst, int maxsize);
int	genom_loco_GetCurrentBattery_encode(char *buffer, int size,
		char *dst, int maxsize);
int	genom_loco_GetCurrentBattery_decode(char *buffer, int size,
		char *dst, int maxsize);
int	genom_loco_GetCurrentMap_encode(char *buffer, int size,
		char *dst, int maxsize);
int	genom_loco_GetCurrentMap_decode(char *buffer, int size,
		char *dst, int maxsize);
int	genom_loco_GetCurrentArena_encode(char *buffer, int size,
		char *dst, int maxsize);
int	genom_loco_GetCurrentArena_decode(char *buffer, int size,
		char *dst, int maxsize);
int	genom_loco_MoveStop_encode(char *buffer, int size,
		char *dst, int maxsize);
int	genom_loco_MoveStop_decode(char *buffer, int size,
		char *dst, int maxsize);
int	genom_loco_BattStop_encode(char *buffer, int size,
		char *dst, int maxsize);
int	genom_loco_BattStop_decode(char *buffer, int size,
		char *dst, int maxsize);
int	genom_loco_StartMove_encode(char *buffer, int size,
		char *dst, int maxsize);
int	genom_loco_StartMove_decode(char *buffer, int size,
		char *dst, int maxsize);
int	genom_loco_StartBatt_encode(char *buffer, int size,
		char *dst, int maxsize);
int	genom_loco_StartBatt_decode(char *buffer, int size,
		char *dst, int maxsize);
int	genom_loco_genom_state_decode(char *buffer,
		genom_state_component *dst);
int	genom_loco_BAT_decode(char *buffer,
		loco_data *dst);


/* --- loco_abort ------------------------------------------------------- */

static void
genom_loco_client_abort_cb(genom_client h, int rqstid, int done,
                       genom_event report, void *output, const void *exdetail,
                       void *cb_data)
{
  (void)done; (void)report; (void)output;
  (void)exdetail; (void)cb_data; /* fix -Wunused-parameter */

  (void)pocolibs_clean(h, rqstid);
}

genom_event
genom_loco_client_abort(genom_client h, int rqstid)
{
  int abrtid, rid;
  genom_event ex;
  int e;

  if (rqstid < 0 || rqstid >= h->nactive)
    return genom_no_such_activity(&h->context);
  if (h->active_rqst[rqstid].status == FREE)
    return genom_no_such_activity(&h->context);
  if (h->active_rqst[rqstid].status == WAITING_INTERMED_REPLY)
    return genom_syserr(&(genom_syserr_detail){.code = EAGAIN}, &h->context);

  ex = pocolibs_newrqst(h, 0, &abrtid);
  if (ex) return ex;

  e = csClientRqstSend(
    h->csid, LOCO_abort_activity_RQSTID,
    (char *)&h->active_rqst[rqstid].aid, 0,
    genom_loco_abort_activity_encode, FALSE, 0, 0, &rid);
  if (e != OK) {
    genom_mwerr_detail d;
    h2getErrMsg(errnoGet(), d.what, sizeof(d.what));
    return genom_mwerr(&d, &h->context);
  }

  h->active_rqst[abrtid].info = genom_loco_client_abort_activity_info;
  h->active_rqst[abrtid].rid = rid;
  h->active_rqst[abrtid].decode = genom_loco_abort_activity_decode;
  h->active_rqst[abrtid].sentcb = NULL;
  h->active_rqst[abrtid].donecb = genom_loco_client_abort_cb;
  h->active_rqst[abrtid].cb_data = NULL;
  h->active_rqst[abrtid].status = WAITING_FINAL_REPLY;

  return genom_ok;
}


/* --- loco_abort_activity_rqst ----------------------------------------- */

genom_event
genom_loco_client_abort_activity_rqst(
  genom_client h,
  const struct genom_loco_abort_activity_input *in,
  loco_abort_activity_cb sentcb, loco_abort_activity_cb donecb,
  void *cb_data,
  int *rqstid)
{
  genom_event ex;
  int rid;
  int e;
  assert(h);

  ex = pocolibs_newrqst(
    h, sizeof(struct genom_loco_abort_activity_output), rqstid);
  if (ex) return ex;

  e = csClientRqstSend(
    h->csid, LOCO_abort_activity_RQSTID,
    (char *)in, 0, genom_loco_abort_activity_encode,
    FALSE, 0, 0, &rid);
  if (e != OK) {
    genom_mwerr_detail d;
    h2getErrMsg(errnoGet(), d.what, sizeof(d.what));
    return genom_mwerr(&d, &h->context);
  }

  genom_loco_client_abort_activity_init_output(
    h->active_rqst[*rqstid].output);
  h->active_rqst[*rqstid].info =
    genom_loco_client_abort_activity_info;
  h->active_rqst[*rqstid].rid = rid;
  h->active_rqst[*rqstid].decode = genom_loco_abort_activity_decode;
  h->active_rqst[*rqstid].sentcb = (genom_request_cb)sentcb;
  h->active_rqst[*rqstid].donecb = (genom_request_cb)donecb;
  h->active_rqst[*rqstid].cb_data = cb_data;
  h->active_rqst[*rqstid].status = WAITING_FINAL_REPLY;

  return genom_ok;
}


/* --- loco_abort_activity_result --------------------------------------- */

genom_event
genom_loco_client_abort_activity_result(
  genom_client h, int rqstid, genom_event *report,
  struct genom_loco_abort_activity_output **out, void **exdetail)
{
  struct genom_client_request *a;
  genom_event s;
  void *p;

  if (rqstid < 0 || rqstid >= h->nactive)
    return genom_syserr(&(genom_syserr_detail){.code = ENOENT}, &h->context);

  a = &h->active_rqst[rqstid];
  if (a->info != genom_loco_client_abort_activity_info)
    return genom_syserr(&(genom_syserr_detail){.code = ENOMSG}, &h->context);

  s = pocolibs_result(h, rqstid, report, &p, exdetail);
  if (s) return s;
  if (out) *out = p;
  return genom_ok;
}


/* --- loco_connect_port_rqst ------------------------------------------- */

genom_event
genom_loco_client_connect_port_rqst(
  genom_client h,
  const struct genom_loco_connect_port_input *in,
  loco_connect_port_cb sentcb, loco_connect_port_cb donecb,
  void *cb_data,
  int *rqstid)
{
  genom_event ex;
  int rid;
  int e;
  assert(h);

  ex = pocolibs_newrqst(
    h, sizeof(struct genom_loco_connect_port_output), rqstid);
  if (ex) return ex;

  e = csClientRqstSend(
    h->csid, LOCO_connect_port_RQSTID,
    (char *)in, 0, genom_loco_connect_port_encode,
    FALSE, 0, 0, &rid);
  if (e != OK) {
    genom_mwerr_detail d;
    h2getErrMsg(errnoGet(), d.what, sizeof(d.what));
    return genom_mwerr(&d, &h->context);
  }

  genom_loco_client_connect_port_init_output(
    h->active_rqst[*rqstid].output);
  h->active_rqst[*rqstid].info =
    genom_loco_client_connect_port_info;
  h->active_rqst[*rqstid].rid = rid;
  h->active_rqst[*rqstid].decode = genom_loco_connect_port_decode;
  h->active_rqst[*rqstid].sentcb = (genom_request_cb)sentcb;
  h->active_rqst[*rqstid].donecb = (genom_request_cb)donecb;
  h->active_rqst[*rqstid].cb_data = cb_data;
  h->active_rqst[*rqstid].status = WAITING_FINAL_REPLY;

  return genom_ok;
}


/* --- loco_connect_port_result ----------------------------------------- */

genom_event
genom_loco_client_connect_port_result(
  genom_client h, int rqstid, genom_event *report,
  struct genom_loco_connect_port_output **out, void **exdetail)
{
  struct genom_client_request *a;
  genom_event s;
  void *p;

  if (rqstid < 0 || rqstid >= h->nactive)
    return genom_syserr(&(genom_syserr_detail){.code = ENOENT}, &h->context);

  a = &h->active_rqst[rqstid];
  if (a->info != genom_loco_client_connect_port_info)
    return genom_syserr(&(genom_syserr_detail){.code = ENOMSG}, &h->context);

  s = pocolibs_result(h, rqstid, report, &p, exdetail);
  if (s) return s;
  if (out) *out = p;
  return genom_ok;
}


/* --- loco_connect_service_rqst ---------------------------------------- */

genom_event
genom_loco_client_connect_service_rqst(
  genom_client h,
  const struct genom_loco_connect_service_input *in,
  loco_connect_service_cb sentcb, loco_connect_service_cb donecb,
  void *cb_data,
  int *rqstid)
{
  genom_event ex;
  int rid;
  int e;
  assert(h);

  ex = pocolibs_newrqst(
    h, sizeof(struct genom_loco_connect_service_output), rqstid);
  if (ex) return ex;

  e = csClientRqstSend(
    h->csid, LOCO_connect_service_RQSTID,
    (char *)in, 0, genom_loco_connect_service_encode,
    FALSE, 0, 0, &rid);
  if (e != OK) {
    genom_mwerr_detail d;
    h2getErrMsg(errnoGet(), d.what, sizeof(d.what));
    return genom_mwerr(&d, &h->context);
  }

  genom_loco_client_connect_service_init_output(
    h->active_rqst[*rqstid].output);
  h->active_rqst[*rqstid].info =
    genom_loco_client_connect_service_info;
  h->active_rqst[*rqstid].rid = rid;
  h->active_rqst[*rqstid].decode = genom_loco_connect_service_decode;
  h->active_rqst[*rqstid].sentcb = (genom_request_cb)sentcb;
  h->active_rqst[*rqstid].donecb = (genom_request_cb)donecb;
  h->active_rqst[*rqstid].cb_data = cb_data;
  h->active_rqst[*rqstid].status = WAITING_FINAL_REPLY;

  return genom_ok;
}


/* --- loco_connect_service_result -------------------------------------- */

genom_event
genom_loco_client_connect_service_result(
  genom_client h, int rqstid, genom_event *report,
  struct genom_loco_connect_service_output **out, void **exdetail)
{
  struct genom_client_request *a;
  genom_event s;
  void *p;

  if (rqstid < 0 || rqstid >= h->nactive)
    return genom_syserr(&(genom_syserr_detail){.code = ENOENT}, &h->context);

  a = &h->active_rqst[rqstid];
  if (a->info != genom_loco_client_connect_service_info)
    return genom_syserr(&(genom_syserr_detail){.code = ENOMSG}, &h->context);

  s = pocolibs_result(h, rqstid, report, &p, exdetail);
  if (s) return s;
  if (out) *out = p;
  return genom_ok;
}


/* --- loco_kill_rqst --------------------------------------------------- */

genom_event
genom_loco_client_kill_rqst(
  genom_client h,
  const struct genom_loco_kill_input *in,
  loco_kill_cb sentcb, loco_kill_cb donecb,
  void *cb_data,
  int *rqstid)
{
  genom_event ex;
  int rid;
  int e;
  assert(h);

  ex = pocolibs_newrqst(
    h, sizeof(struct genom_loco_kill_output), rqstid);
  if (ex) return ex;

  e = csClientRqstSend(
    h->csid, LOCO_kill_RQSTID,
    (char *)in, 0, genom_loco_kill_encode,
    FALSE, 0, 0, &rid);
  if (e != OK) {
    genom_mwerr_detail d;
    h2getErrMsg(errnoGet(), d.what, sizeof(d.what));
    return genom_mwerr(&d, &h->context);
  }

  genom_loco_client_kill_init_output(
    h->active_rqst[*rqstid].output);
  h->active_rqst[*rqstid].info =
    genom_loco_client_kill_info;
  h->active_rqst[*rqstid].rid = rid;
  h->active_rqst[*rqstid].decode = genom_loco_kill_decode;
  h->active_rqst[*rqstid].sentcb = (genom_request_cb)sentcb;
  h->active_rqst[*rqstid].donecb = (genom_request_cb)donecb;
  h->active_rqst[*rqstid].cb_data = cb_data;
  h->active_rqst[*rqstid].status = WAITING_FINAL_REPLY;

  return genom_ok;
}


/* --- loco_kill_result ------------------------------------------------- */

genom_event
genom_loco_client_kill_result(
  genom_client h, int rqstid, genom_event *report,
  struct genom_loco_kill_output **out, void **exdetail)
{
  struct genom_client_request *a;
  genom_event s;
  void *p;

  if (rqstid < 0 || rqstid >= h->nactive)
    return genom_syserr(&(genom_syserr_detail){.code = ENOENT}, &h->context);

  a = &h->active_rqst[rqstid];
  if (a->info != genom_loco_client_kill_info)
    return genom_syserr(&(genom_syserr_detail){.code = ENOMSG}, &h->context);

  s = pocolibs_result(h, rqstid, report, &p, exdetail);
  if (s) return s;
  if (out) *out = p;
  return genom_ok;
}


/* --- loco_GetCurrentPosition_rqst ------------------------------------- */

genom_event
genom_loco_client_GetCurrentPosition_rqst(
  genom_client h,
  const struct genom_loco_GetCurrentPosition_input *in,
  loco_GetCurrentPosition_cb sentcb, loco_GetCurrentPosition_cb donecb,
  void *cb_data,
  int *rqstid)
{
  genom_event ex;
  int rid;
  int e;
  assert(h);

  ex = pocolibs_newrqst(
    h, sizeof(struct genom_loco_GetCurrentPosition_output), rqstid);
  if (ex) return ex;

  e = csClientRqstSend(
    h->csid, LOCO_GetCurrentPosition_RQSTID,
    (char *)in, 0, genom_loco_GetCurrentPosition_encode,
    FALSE, 0, 0, &rid);
  if (e != OK) {
    genom_mwerr_detail d;
    h2getErrMsg(errnoGet(), d.what, sizeof(d.what));
    return genom_mwerr(&d, &h->context);
  }

  genom_loco_client_GetCurrentPosition_init_output(
    h->active_rqst[*rqstid].output);
  h->active_rqst[*rqstid].info =
    genom_loco_client_GetCurrentPosition_info;
  h->active_rqst[*rqstid].rid = rid;
  h->active_rqst[*rqstid].decode = genom_loco_GetCurrentPosition_decode;
  h->active_rqst[*rqstid].sentcb = (genom_request_cb)sentcb;
  h->active_rqst[*rqstid].donecb = (genom_request_cb)donecb;
  h->active_rqst[*rqstid].cb_data = cb_data;
  h->active_rqst[*rqstid].status = WAITING_FINAL_REPLY;

  return genom_ok;
}


/* --- loco_GetCurrentPosition_result ----------------------------------- */

genom_event
genom_loco_client_GetCurrentPosition_result(
  genom_client h, int rqstid, genom_event *report,
  struct genom_loco_GetCurrentPosition_output **out, void **exdetail)
{
  struct genom_client_request *a;
  genom_event s;
  void *p;

  if (rqstid < 0 || rqstid >= h->nactive)
    return genom_syserr(&(genom_syserr_detail){.code = ENOENT}, &h->context);

  a = &h->active_rqst[rqstid];
  if (a->info != genom_loco_client_GetCurrentPosition_info)
    return genom_syserr(&(genom_syserr_detail){.code = ENOMSG}, &h->context);

  s = pocolibs_result(h, rqstid, report, &p, exdetail);
  if (s) return s;
  if (out) *out = p;
  return genom_ok;
}


/* --- loco_GetCurrentBattery_rqst -------------------------------------- */

genom_event
genom_loco_client_GetCurrentBattery_rqst(
  genom_client h,
  const struct genom_loco_GetCurrentBattery_input *in,
  loco_GetCurrentBattery_cb sentcb, loco_GetCurrentBattery_cb donecb,
  void *cb_data,
  int *rqstid)
{
  genom_event ex;
  int rid;
  int e;
  assert(h);

  ex = pocolibs_newrqst(
    h, sizeof(struct genom_loco_GetCurrentBattery_output), rqstid);
  if (ex) return ex;

  e = csClientRqstSend(
    h->csid, LOCO_GetCurrentBattery_RQSTID,
    (char *)in, 0, genom_loco_GetCurrentBattery_encode,
    FALSE, 0, 0, &rid);
  if (e != OK) {
    genom_mwerr_detail d;
    h2getErrMsg(errnoGet(), d.what, sizeof(d.what));
    return genom_mwerr(&d, &h->context);
  }

  genom_loco_client_GetCurrentBattery_init_output(
    h->active_rqst[*rqstid].output);
  h->active_rqst[*rqstid].info =
    genom_loco_client_GetCurrentBattery_info;
  h->active_rqst[*rqstid].rid = rid;
  h->active_rqst[*rqstid].decode = genom_loco_GetCurrentBattery_decode;
  h->active_rqst[*rqstid].sentcb = (genom_request_cb)sentcb;
  h->active_rqst[*rqstid].donecb = (genom_request_cb)donecb;
  h->active_rqst[*rqstid].cb_data = cb_data;
  h->active_rqst[*rqstid].status = WAITING_FINAL_REPLY;

  return genom_ok;
}


/* --- loco_GetCurrentBattery_result ------------------------------------ */

genom_event
genom_loco_client_GetCurrentBattery_result(
  genom_client h, int rqstid, genom_event *report,
  struct genom_loco_GetCurrentBattery_output **out, void **exdetail)
{
  struct genom_client_request *a;
  genom_event s;
  void *p;

  if (rqstid < 0 || rqstid >= h->nactive)
    return genom_syserr(&(genom_syserr_detail){.code = ENOENT}, &h->context);

  a = &h->active_rqst[rqstid];
  if (a->info != genom_loco_client_GetCurrentBattery_info)
    return genom_syserr(&(genom_syserr_detail){.code = ENOMSG}, &h->context);

  s = pocolibs_result(h, rqstid, report, &p, exdetail);
  if (s) return s;
  if (out) *out = p;
  return genom_ok;
}


/* --- loco_GetCurrentMap_rqst ------------------------------------------ */

genom_event
genom_loco_client_GetCurrentMap_rqst(
  genom_client h,
  const struct genom_loco_GetCurrentMap_input *in,
  loco_GetCurrentMap_cb sentcb, loco_GetCurrentMap_cb donecb,
  void *cb_data,
  int *rqstid)
{
  genom_event ex;
  int rid;
  int e;
  assert(h);

  ex = pocolibs_newrqst(
    h, sizeof(struct genom_loco_GetCurrentMap_output), rqstid);
  if (ex) return ex;

  e = csClientRqstSend(
    h->csid, LOCO_GetCurrentMap_RQSTID,
    (char *)in, 0, genom_loco_GetCurrentMap_encode,
    FALSE, 0, 0, &rid);
  if (e != OK) {
    genom_mwerr_detail d;
    h2getErrMsg(errnoGet(), d.what, sizeof(d.what));
    return genom_mwerr(&d, &h->context);
  }

  genom_loco_client_GetCurrentMap_init_output(
    h->active_rqst[*rqstid].output);
  h->active_rqst[*rqstid].info =
    genom_loco_client_GetCurrentMap_info;
  h->active_rqst[*rqstid].rid = rid;
  h->active_rqst[*rqstid].decode = genom_loco_GetCurrentMap_decode;
  h->active_rqst[*rqstid].sentcb = (genom_request_cb)sentcb;
  h->active_rqst[*rqstid].donecb = (genom_request_cb)donecb;
  h->active_rqst[*rqstid].cb_data = cb_data;
  h->active_rqst[*rqstid].status = WAITING_FINAL_REPLY;

  return genom_ok;
}


/* --- loco_GetCurrentMap_result ---------------------------------------- */

genom_event
genom_loco_client_GetCurrentMap_result(
  genom_client h, int rqstid, genom_event *report,
  struct genom_loco_GetCurrentMap_output **out, void **exdetail)
{
  struct genom_client_request *a;
  genom_event s;
  void *p;

  if (rqstid < 0 || rqstid >= h->nactive)
    return genom_syserr(&(genom_syserr_detail){.code = ENOENT}, &h->context);

  a = &h->active_rqst[rqstid];
  if (a->info != genom_loco_client_GetCurrentMap_info)
    return genom_syserr(&(genom_syserr_detail){.code = ENOMSG}, &h->context);

  s = pocolibs_result(h, rqstid, report, &p, exdetail);
  if (s) return s;
  if (out) *out = p;
  return genom_ok;
}


/* --- loco_GetCurrentArena_rqst ---------------------------------------- */

genom_event
genom_loco_client_GetCurrentArena_rqst(
  genom_client h,
  const struct genom_loco_GetCurrentArena_input *in,
  loco_GetCurrentArena_cb sentcb, loco_GetCurrentArena_cb donecb,
  void *cb_data,
  int *rqstid)
{
  genom_event ex;
  int rid;
  int e;
  assert(h);

  ex = pocolibs_newrqst(
    h, sizeof(struct genom_loco_GetCurrentArena_output), rqstid);
  if (ex) return ex;

  e = csClientRqstSend(
    h->csid, LOCO_GetCurrentArena_RQSTID,
    (char *)in, 0, genom_loco_GetCurrentArena_encode,
    FALSE, 0, 0, &rid);
  if (e != OK) {
    genom_mwerr_detail d;
    h2getErrMsg(errnoGet(), d.what, sizeof(d.what));
    return genom_mwerr(&d, &h->context);
  }

  genom_loco_client_GetCurrentArena_init_output(
    h->active_rqst[*rqstid].output);
  h->active_rqst[*rqstid].info =
    genom_loco_client_GetCurrentArena_info;
  h->active_rqst[*rqstid].rid = rid;
  h->active_rqst[*rqstid].decode = genom_loco_GetCurrentArena_decode;
  h->active_rqst[*rqstid].sentcb = (genom_request_cb)sentcb;
  h->active_rqst[*rqstid].donecb = (genom_request_cb)donecb;
  h->active_rqst[*rqstid].cb_data = cb_data;
  h->active_rqst[*rqstid].status = WAITING_FINAL_REPLY;

  return genom_ok;
}


/* --- loco_GetCurrentArena_result -------------------------------------- */

genom_event
genom_loco_client_GetCurrentArena_result(
  genom_client h, int rqstid, genom_event *report,
  struct genom_loco_GetCurrentArena_output **out, void **exdetail)
{
  struct genom_client_request *a;
  genom_event s;
  void *p;

  if (rqstid < 0 || rqstid >= h->nactive)
    return genom_syserr(&(genom_syserr_detail){.code = ENOENT}, &h->context);

  a = &h->active_rqst[rqstid];
  if (a->info != genom_loco_client_GetCurrentArena_info)
    return genom_syserr(&(genom_syserr_detail){.code = ENOMSG}, &h->context);

  s = pocolibs_result(h, rqstid, report, &p, exdetail);
  if (s) return s;
  if (out) *out = p;
  return genom_ok;
}


/* --- loco_MoveStop_rqst ----------------------------------------------- */

genom_event
genom_loco_client_MoveStop_rqst(
  genom_client h,
  const struct genom_loco_MoveStop_input *in,
  loco_MoveStop_cb sentcb, loco_MoveStop_cb donecb,
  void *cb_data,
  int *rqstid)
{
  genom_event ex;
  int rid;
  int e;
  assert(h);

  ex = pocolibs_newrqst(
    h, sizeof(struct genom_loco_MoveStop_output), rqstid);
  if (ex) return ex;

  e = csClientRqstSend(
    h->csid, LOCO_MoveStop_RQSTID,
    (char *)in, 0, genom_loco_MoveStop_encode,
    FALSE, 0, 0, &rid);
  if (e != OK) {
    genom_mwerr_detail d;
    h2getErrMsg(errnoGet(), d.what, sizeof(d.what));
    return genom_mwerr(&d, &h->context);
  }

  genom_loco_client_MoveStop_init_output(
    h->active_rqst[*rqstid].output);
  h->active_rqst[*rqstid].info =
    genom_loco_client_MoveStop_info;
  h->active_rqst[*rqstid].rid = rid;
  h->active_rqst[*rqstid].decode = genom_loco_MoveStop_decode;
  h->active_rqst[*rqstid].sentcb = (genom_request_cb)sentcb;
  h->active_rqst[*rqstid].donecb = (genom_request_cb)donecb;
  h->active_rqst[*rqstid].cb_data = cb_data;
  h->active_rqst[*rqstid].status = WAITING_FINAL_REPLY;

  return genom_ok;
}


/* --- loco_MoveStop_result --------------------------------------------- */

genom_event
genom_loco_client_MoveStop_result(
  genom_client h, int rqstid, genom_event *report,
  struct genom_loco_MoveStop_output **out, void **exdetail)
{
  struct genom_client_request *a;
  genom_event s;
  void *p;

  if (rqstid < 0 || rqstid >= h->nactive)
    return genom_syserr(&(genom_syserr_detail){.code = ENOENT}, &h->context);

  a = &h->active_rqst[rqstid];
  if (a->info != genom_loco_client_MoveStop_info)
    return genom_syserr(&(genom_syserr_detail){.code = ENOMSG}, &h->context);

  s = pocolibs_result(h, rqstid, report, &p, exdetail);
  if (s) return s;
  if (out) *out = p;
  return genom_ok;
}


/* --- loco_BattStop_rqst ----------------------------------------------- */

genom_event
genom_loco_client_BattStop_rqst(
  genom_client h,
  const struct genom_loco_BattStop_input *in,
  loco_BattStop_cb sentcb, loco_BattStop_cb donecb,
  void *cb_data,
  int *rqstid)
{
  genom_event ex;
  int rid;
  int e;
  assert(h);

  ex = pocolibs_newrqst(
    h, sizeof(struct genom_loco_BattStop_output), rqstid);
  if (ex) return ex;

  e = csClientRqstSend(
    h->csid, LOCO_BattStop_RQSTID,
    (char *)in, 0, genom_loco_BattStop_encode,
    FALSE, 0, 0, &rid);
  if (e != OK) {
    genom_mwerr_detail d;
    h2getErrMsg(errnoGet(), d.what, sizeof(d.what));
    return genom_mwerr(&d, &h->context);
  }

  genom_loco_client_BattStop_init_output(
    h->active_rqst[*rqstid].output);
  h->active_rqst[*rqstid].info =
    genom_loco_client_BattStop_info;
  h->active_rqst[*rqstid].rid = rid;
  h->active_rqst[*rqstid].decode = genom_loco_BattStop_decode;
  h->active_rqst[*rqstid].sentcb = (genom_request_cb)sentcb;
  h->active_rqst[*rqstid].donecb = (genom_request_cb)donecb;
  h->active_rqst[*rqstid].cb_data = cb_data;
  h->active_rqst[*rqstid].status = WAITING_FINAL_REPLY;

  return genom_ok;
}


/* --- loco_BattStop_result --------------------------------------------- */

genom_event
genom_loco_client_BattStop_result(
  genom_client h, int rqstid, genom_event *report,
  struct genom_loco_BattStop_output **out, void **exdetail)
{
  struct genom_client_request *a;
  genom_event s;
  void *p;

  if (rqstid < 0 || rqstid >= h->nactive)
    return genom_syserr(&(genom_syserr_detail){.code = ENOENT}, &h->context);

  a = &h->active_rqst[rqstid];
  if (a->info != genom_loco_client_BattStop_info)
    return genom_syserr(&(genom_syserr_detail){.code = ENOMSG}, &h->context);

  s = pocolibs_result(h, rqstid, report, &p, exdetail);
  if (s) return s;
  if (out) *out = p;
  return genom_ok;
}


/* --- loco_StartMove_rqst ---------------------------------------------- */

genom_event
genom_loco_client_StartMove_rqst(
  genom_client h,
  const struct genom_loco_StartMove_input *in,
  loco_StartMove_cb sentcb, loco_StartMove_cb donecb,
  void *cb_data,
  int *rqstid)
{
  genom_event ex;
  int rid;
  int e;
  assert(h);

  ex = pocolibs_newrqst(
    h, sizeof(struct genom_loco_StartMove_output), rqstid);
  if (ex) return ex;

  e = csClientRqstSend(
    h->csid, LOCO_StartMove_RQSTID,
    (char *)in, 0, genom_loco_StartMove_encode,
    TRUE, 0, 0, &rid);
  if (e != OK) {
    genom_mwerr_detail d;
    h2getErrMsg(errnoGet(), d.what, sizeof(d.what));
    return genom_mwerr(&d, &h->context);
  }

  genom_loco_client_StartMove_init_output(
    h->active_rqst[*rqstid].output);
  h->active_rqst[*rqstid].info =
    genom_loco_client_StartMove_info;
  h->active_rqst[*rqstid].rid = rid;
  h->active_rqst[*rqstid].decode = genom_loco_StartMove_decode;
  h->active_rqst[*rqstid].sentcb = (genom_request_cb)sentcb;
  h->active_rqst[*rqstid].donecb = (genom_request_cb)donecb;
  h->active_rqst[*rqstid].cb_data = cb_data;
  h->active_rqst[*rqstid].status = WAITING_INTERMED_REPLY;

  return genom_ok;
}


/* --- loco_StartMove_result -------------------------------------------- */

genom_event
genom_loco_client_StartMove_result(
  genom_client h, int rqstid, genom_event *report,
  struct genom_loco_StartMove_output **out, void **exdetail)
{
  struct genom_client_request *a;
  genom_event s;
  void *p;

  if (rqstid < 0 || rqstid >= h->nactive)
    return genom_syserr(&(genom_syserr_detail){.code = ENOENT}, &h->context);

  a = &h->active_rqst[rqstid];
  if (a->info != genom_loco_client_StartMove_info)
    return genom_syserr(&(genom_syserr_detail){.code = ENOMSG}, &h->context);

  s = pocolibs_result(h, rqstid, report, &p, exdetail);
  if (s) return s;
  if (out) *out = p;
  return genom_ok;
}


/* --- loco_StartBatt_rqst ---------------------------------------------- */

genom_event
genom_loco_client_StartBatt_rqst(
  genom_client h,
  const struct genom_loco_StartBatt_input *in,
  loco_StartBatt_cb sentcb, loco_StartBatt_cb donecb,
  void *cb_data,
  int *rqstid)
{
  genom_event ex;
  int rid;
  int e;
  assert(h);

  ex = pocolibs_newrqst(
    h, sizeof(struct genom_loco_StartBatt_output), rqstid);
  if (ex) return ex;

  e = csClientRqstSend(
    h->csid, LOCO_StartBatt_RQSTID,
    (char *)in, 0, genom_loco_StartBatt_encode,
    TRUE, 0, 0, &rid);
  if (e != OK) {
    genom_mwerr_detail d;
    h2getErrMsg(errnoGet(), d.what, sizeof(d.what));
    return genom_mwerr(&d, &h->context);
  }

  genom_loco_client_StartBatt_init_output(
    h->active_rqst[*rqstid].output);
  h->active_rqst[*rqstid].info =
    genom_loco_client_StartBatt_info;
  h->active_rqst[*rqstid].rid = rid;
  h->active_rqst[*rqstid].decode = genom_loco_StartBatt_decode;
  h->active_rqst[*rqstid].sentcb = (genom_request_cb)sentcb;
  h->active_rqst[*rqstid].donecb = (genom_request_cb)donecb;
  h->active_rqst[*rqstid].cb_data = cb_data;
  h->active_rqst[*rqstid].status = WAITING_INTERMED_REPLY;

  return genom_ok;
}


/* --- loco_StartBatt_result -------------------------------------------- */

genom_event
genom_loco_client_StartBatt_result(
  genom_client h, int rqstid, genom_event *report,
  struct genom_loco_StartBatt_output **out, void **exdetail)
{
  struct genom_client_request *a;
  genom_event s;
  void *p;

  if (rqstid < 0 || rqstid >= h->nactive)
    return genom_syserr(&(genom_syserr_detail){.code = ENOENT}, &h->context);

  a = &h->active_rqst[rqstid];
  if (a->info != genom_loco_client_StartBatt_info)
    return genom_syserr(&(genom_syserr_detail){.code = ENOMSG}, &h->context);

  s = pocolibs_result(h, rqstid, report, &p, exdetail);
  if (s) return s;
  if (out) *out = p;
  return genom_ok;
}



/* --- loco_genom_state_port -------------------------------------------- */

genom_event
genom_loco_client_genom_state_port(
  genom_client h,
  genom_state_component *data)
{
  static POSTER_ID id;
  int searched = 0;
  char *addr;
  int s;

  do {
    if (!id) {
      char name[H2_DEV_MAX_NAME];
      int n;

      n = snprintf(name, sizeof(name), "%s/genom_state", h->instance);
      if (n <= 0 || n >= (signed)sizeof(name))
        return genom_syserr(&(genom_syserr_detail){.code = ENAMETOOLONG},
                            &h->context);

      if (posterFind(name, &id) != OK) {
        genom_mwerr_detail d;
        h2getErrMsg(errnoGet(), d.what, sizeof(d.what));
        return genom_mwerr(&d, &h->context);
      }
      searched = 1;
    }

    if (posterTake(id, POSTER_READ) != OK) {
      genom_mwerr_detail d;
      int code = errnoGet();
      if (!searched && code == S_posterLib_POSTER_CLOSED) {
        id = NULL; continue /* try to refetch poster id */;
      }
      h2getErrMsg(code, d.what, sizeof(d.what));
      return genom_mwerr(&d, &h->context);
    }
    addr = posterAddr(id);
    s = genom_loco_genom_state_decode(addr, data);
    posterGive(id);
    break;
  } while(1);

  if (s)
    return genom_syserr(&(genom_syserr_detail){.code = s}, &h->context);
  return genom_ok;
}


/* --- loco_BAT_port ---------------------------------------------------- */

genom_event
genom_loco_client_BAT_port(
  genom_client h,
  loco_data *data)
{
  static POSTER_ID id;
  int searched = 0;
  char *addr;
  int s;

  do {
    if (!id) {
      char name[H2_DEV_MAX_NAME];
      int n;

      n = snprintf(name, sizeof(name), "%s/BAT", h->instance);
      if (n <= 0 || n >= (signed)sizeof(name))
        return genom_syserr(&(genom_syserr_detail){.code = ENAMETOOLONG},
                            &h->context);

      if (posterFind(name, &id) != OK) {
        genom_mwerr_detail d;
        h2getErrMsg(errnoGet(), d.what, sizeof(d.what));
        return genom_mwerr(&d, &h->context);
      }
      searched = 1;
    }

    if (posterTake(id, POSTER_READ) != OK) {
      genom_mwerr_detail d;
      int code = errnoGet();
      if (!searched && code == S_posterLib_POSTER_CLOSED) {
        id = NULL; continue /* try to refetch poster id */;
      }
      h2getErrMsg(code, d.what, sizeof(d.what));
      return genom_mwerr(&d, &h->context);
    }
    addr = posterAddr(id);
    s = genom_loco_BAT_decode(addr, data);
    posterGive(id);
    break;
  } while(1);

  if (s)
    return genom_syserr(&(genom_syserr_detail){.code = s}, &h->context);
  return genom_ok;
}

